{% extends "eventos/base.html" %}

{%block title %}{{evento.titulo}}{% endblock %}

{% block main-content %} 

<div class="container my-4">
    <div class="card ">
        <div class="row g-0  align-items-center left_to_center ">
            <div class="col-md-2 p-3">
                <img src="{{evento.imagen.url}}" class="img-fluid rounded-start" alt="logo">
            </div>
            <div class="col-md-10 ">
                <div class="p-3">
                    <h1 class="card-title">{{evento.titulo}}</h1>
                    <h3 class="card-text">{{evento.titulo_largo}}</h3>
                    <p class="card-text"><small class="text-body-secondary">{{evento.fecha_inicio}}</small></p>   
                </div>      
            </div>
        </div>           
        <hr class="m-0">
        <div class="row g-0 fondo align-items-end p-3">
            <div class="col-12 col-md-6 col-lg-6 mb-4">
                <form method="post">
                    {% csrf_token %}
                    {% comment %} {{ form.as_p }} {% endcomment %}
                    <div class="form-opciones">
                    
                        <!-- 'precioModality' -->                            
                        <label class="mb-2" for="{{ form.precioModality.id_for_label }}">{{ form.precioModality.label }}</label>
                        {{ form.precioModality }}   

                        <!-- 'precioFinal' -->
                         <div class="left_to_center">
                            <label class="precio-final-letras" for="{{ form.precioFinal.id_for_label }}">{{ form.precioFinal.label }}</label>
                            <span class="euro-symbol precio-final-letras">â‚¬</span>
                            {{ form.precioFinal }}
                        </div>

                    </div>
                </form>
            </div>
            <div class="col-12 col-md-6 col-lg-6 mb-6 end-to-center">
                <form method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-i3a mt-3">Continue</button>
                </form>
            </div>
        </div>   
    </div>    
</div>

<div class="container p-3">
    <p>{{evento.descripcion}}</p>
</div>

{% endblock %}

{% block extras %}

<script>
    // Capturar cambio en el campo de precio
    $("input[name='precioModality']").on('change', function () {
        var nuevoPrecio = $(this).val();  // Valor seleccionado
        //var nuevoPrecio = $("input[name='precioModality']:checked").val();
        
        var url = "{% url 'detalle_evento' evento.codigo_i3a %}";  // URL de la vista AJAX
        var csrfToken = $("input[name=csrfmiddlewaretoken]").val();  // Token CSRF

        // Enviar solicitud AJAX para recargar con el nuevo precio               
        $.ajax({
            type: "POST",
            url: url,
            data: {
                'nuevoPrecio': nuevoPrecio,
                'csrfmiddlewaretoken': csrfToken,
            },
            // Recojo el valor devuelto por la view para actualizar el campo precio
            success: function (response) {
                if (response.mensaje === 'Precio recibido correctamente') {
                    $("#id_precioFinal").val(response.nuevoPrecio);
                } else {
                    console.log("Error en respuesta AJAX: ", response);
                }
            },
            error: function () {
                console.log('Error en la solicitud.');
            }
        });

    });

</script> 

{% endblock %}
